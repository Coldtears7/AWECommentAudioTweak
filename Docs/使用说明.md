# AWECommentAudioTweak 详细使用说明

## 目录

- [安装与注入](#安装与注入)
- [语音下载](#语音下载)
- [音频替换](#音频替换)
- [音频选择面板](#音频选择面板)
- [AI 语音合成](#ai-语音合成)
- [火山引擎 TTS 配置](#火山引擎-tts-配置)
- [千问 TTS 配置](#千问-tts-配置)
- [音色管理](#音色管理)
- [文件管理](#文件管理)
- [常见问题](#常见问题)

---

## 安装与注入

### 环境要求

- iOS 15.0 或更高版本
- 已安装 TrollStore（巨魔商店）
- macOS 上配置好 Theos 编译环境

### 编译

```bash
make -C AWECommentAudioTweak
```

编译产物位于 `.theos/obj/arm64/AWECommentAudioTweak.dylib`。

### 注入

1. 将编译好的 `AWECommentAudioTweak.dylib` 传输到 iPhone
2. 打开 TrollTools，选择抖音 App
3. 注入 dylib 文件
4. 重启抖音即可生效

---

## 语音下载

在评论区播放一条语音评论后，长按该语音评论，弹出保存对话框。点击保存后，插件会从 CDN 直链下载语音文件到本地沙盒目录 `AWECommentAudio/`。

文件命名格式：`评论ID_时长ms.m4a`

---

## 音频替换

### 基本原理

开启替换后，你在评论区录制的语音会被自动替换为你选择的音频文件。对方听到的是你选的音频，而不是你实际录制的内容。

### 启用状态

- 语音按钮上出现红点 = 替换已启用
- 导航栏会显示当前替换的音频文件名和时长
- 替换状态通过 NSUserDefaults 持久化，重启抖音不会丢失

### 关闭替换

在音频选择面板底部点击「关闭替换」即可恢复正常录音。

---

## 音频选择面板

长按评论输入栏的语音按钮（麦克风图标），打开音频选择面板。

### 面板结构

面板分为两个区域：

**收藏音频**：你收藏的常用音频列表，点击即可设为替换音频。左滑可移除收藏。

**操作列表**：

- **添加收藏**：从插件目录中选择已下载的音频文件加入收藏列表
- **本机导入**：从 iPhone 本地文件中选择音频或 zip 文件导入。支持多选，zip 会自动解压。非 m4a 格式会自动转码
- **插件目录**：浏览插件沙盒目录 `AWECommentAudio/` 下的所有文件和文件夹，仅显示 .m4a 文件
- **音色合成**：进入 AI 语音合成功能（详见下方说明）
- **关于作者**：显示作者联系方式
- **关闭替换**：关闭当前音频替换（仅在替换启用时显示）

点击操作项左侧的图标可查看该功能的帮助说明。

---

## AI 语音合成

评论输入栏语音按钮旁边会出现一个云朵图标（AI 合成入口）。点击后进入合成界面。

### 使用流程

1. 点击云朵图标进入 AI 合成页面
2. 在文本框中输入要合成的文字
3. 点击顶部音色名称可进入音色选择
4. 点击「合成替换」按钮
5. 等待合成完成，成功后自动设为替换音频
6. 返回评论区，录制语音即发送合成的内容

### 合成界面说明

- 顶部标题栏显示当前选择的音色名称和后端（火山/千问）
- 文本框支持多行输入
- 「合成替换」按钮：合成语音并设为替换音频
- 合成过程中会显示 loading 提示

---

## 火山引擎 TTS 配置

火山引擎提供 300+ 音色，支持语速/音量/音调参数调节。

### 获取凭证

1. 注册 [火山引擎账号](https://console.volcengine.com/)
2. 进入控制台，开通「语音技术」->「语音合成」服务
3. 创建应用，获取 **App ID**
4. 在「语音合成」->「音色管理」中选择需要的音色并开通授权
5. 进入「API Key 管理」，创建并复制 **Access Token**

### 填写配置

在音频选择面板点击「音色合成」，进入配置页面，在「火山引擎」区域填写：

| 字段 | 说明 | 示例 |
|------|------|------|
| App ID | 应用 ID | `12345678` |
| Access Token | API 密钥 | `xxx-xxx-xxx` |
| Cluster | 集群名称，一般默认即可 | `volcano_tts` |

填写完成后点击右上角「保存」。

### 参数调节

火山引擎支持以下语音参数（范围 0.2 ~ 3.0，默认 1.0）：

- **语速**：控制语音播放速度
- **音量**：控制语音音量大小
- **音调**：控制语音音调高低

---

## 千问 TTS 配置

千问 TTS 基于阿里云百炼平台，提供 49 个系统音色。

### 获取凭证

1. 注册 [阿里云账号](https://account.aliyun.com/)
2. 进入 [百炼控制台](https://bailian.console.aliyun.com/)
3. 点击右上角「API Key 管理」
4. 创建并复制 **API Key**（格式为 `sk-xxx`）

### 填写配置

在配置页面的「千问 TTS」区域填写 API Key，点击「保存」即可。

### 选择千问音色

点击「音色选择」时会弹出选择框，选择「千问 TTS」进入千问音色列表。

千问音色分类：

| 分类 | 数量 | 示例 |
|------|------|------|
| 普通话 | 25 个 | 芊悦 Cherry、晨煦 Ethan、苏瑶 Serena |
| 多语种 | 16 个 | 西语、俄语、意语、韩语、日语等 |
| 方言 | 8 个 | 上海话、北京话、四川话、粤语、闽南语 |

---

## 音色管理

### 推荐音色

音色列表顶部为「推荐音色」区域，默认包含几个常用音色。

- **左滑移除**：在推荐区左滑可移除该音色
- **左滑加入**：在全部音色区左滑可将音色加入推荐
- 推荐列表独立持久化，火山和千问各自独立存储

### 搜索音色

音色列表顶部有搜索栏，支持按音色名称或 voiceType 搜索。

### 试听音色

每个音色右侧有播放按钮，点击可试听该音色效果。试听会使用当前配置的 API 凭证合成一段示例文字。

---

## 文件管理

### 目录结构

插件在抖音沙盒的 Documents 目录下创建以下结构：

```
AWECommentAudio/
├── 导入音频/          # 本机导入的音频文件
├── [评论ID_时长.m4a]  # 下载的语音评论
└── [其他子文件夹]     # 用户自建的分类文件夹
```

### 导入音频

通过「本机导入」功能可以从 iPhone 文件 App 中选择音频文件或 zip 压缩包：

- 支持格式：m4a、aac、mp3、wav、caf 等常见音频格式
- 非 m4a 格式会自动转码为 m4a
- zip 文件会自动解压到目标目录
- 支持多选导入
- 导入时可选择目标文件夹或新建文件夹

---

## 常见问题

### Q: AI 合成按钮（云朵图标）没有出现？

A: 确保插件已正确注入。云朵图标会在评论输入栏的语音按钮旁边显示，需要先点击评论区让输入栏出现。

### Q: 合成失败提示 API 错误？

A: 检查 API 凭证是否正确填写。火山引擎需要 App ID、Access Token 和 Cluster 三个字段；千问只需要 API Key。

### Q: 替换后对方听到的时长不对？

A: 替换音频的实际时长可能与录制时长不同。建议选择时长接近的音频，或使用 AI 合成控制文字长度来匹配。

### Q: 推荐音色清空后又恢复默认了？

A: 此问题已在最新版本修复。请确保使用最新编译的 dylib。

### Q: 导入的音频在哪里？

A: 导入的音频存放在 `AWECommentAudio/导入音频/` 目录下，可通过「插件目录」功能浏览。

---

## 作者

[@cookieodd](https://github.com/cookieodd) | [Telegram](https://t.me/cookieodd)
